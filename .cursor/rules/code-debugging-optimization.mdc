---
alwaysApply: true
---
# 代码调试和优化最佳实践规则

## 核心原则：最小化修改 (Minimal Changes Principle)

### 1. 原子性修改 (Atomic Changes)
- **一次只做一个逻辑修改** - 每个修改应该是最小的、可测试的、有意义的单元
- **避免组合多个不相关的修改** - 当同时进行两个修改时，有四种可能的结果，其中三种是不好的
- **遵循"Make it work, Make it right, Make it fast"顺序**：
  1. 先确保正确性 (Correctness)
  2. 再提升清晰度 (Clarity) 
  3. 然后简洁性 (Conciseness)
  4. 最后优化性能 (Performance)

### 2. 参数化进展 (Parametric Progress)
- **一次只改变一个参数** - 修改一个方面，观察系统反应，学习因果关系
- **在进行下一个修改前要完全理解当前修改的影响**
- **如果需要回退，确保能恢复到修改前的确切状态**

## 调试工作流程

### 3. 调试优先级
```
1. 隔离问题 → 2. 最小重现 → 3. 单点修改 → 4. 验证修复 → 5. 学习总结
```

### 4. 调试策略
- **仅添加调试日志模式** - 限制AI只能添加调试日志，不能重写代码
- **使用短反馈循环** - 每次修改后立即测试
- **保持调试环境干净** - 修改前记录初始状态，便于回退
- **追踪编辑距离** - 评估修改的复杂度，优先选择编辑距离最小的解决方案

### 5. Python项目特殊规则
根据项目配置，在进行Python相关操作时：
- **必须使用 `uv` 命令**进行包管理和环境操作
- 替代 `pip install` 使用 `uv add`
- 替代 `python -m` 使用 `uv run`
- 替代虚拟环境操作使用 `uv venv` 和 `uv sync`

## 代码优化最佳实践

### 6. 性能优化策略
- **先测量，后优化** - 使用性能分析工具识别真正的瓶颈
- **关注编译器友好的代码结构**：
  - 将 `if` 语句提升到顶层，减少循环内分支
  - 将 `for` 循环下沉到函数内部，支持批处理
  - 避免在热循环中使用 `switch` 语句
- **最小化重复访问** - 将重复的属性访问提取为变量
- **优先使用箭头函数** (ES6+) - 更好的压缩效果和性能

### 7. 代码组织原则
- **提取变量减少重复** - 特别是字符串常量和属性访问
- **避免不必要的对象属性** - 考虑使用工厂函数或简单参数
- **函数参数优化** - 避免对象参数模式，除非有大量可选参数

### 8. 何时进行网络搜索
在以下情况下使用web搜索获取最新最佳实践：
- **遇到特定技术栈的性能瓶颈**时搜索对应优化技巧
- **需要了解最新的调试工具**和技术时
- **面对不熟悉的错误模式**需要社区解决方案时
- **评估新的优化技术**是否适合当前项目时

## 代码质量控制

### 9. 错误预防
- **使用类型系统** - 在支持的语言中利用静态类型检查
- **编写单元测试** - 特别是对修改的核心逻辑
- **持续集成验证** - 确保修改不破坏现有功能
- **代码审查流程** - 让他人验证修改的正确性

### 10. 重构指导
- **如果重构能简化目标修改，优先进行重构**
- **保持重构和功能修改分离** - 分别提交
- **重构时遵循单一职责原则**
- **避免过早优化** - 先确保功能正确

## 学习和改进

### 11. 知识积累
- **记录每次调试的根本原因** - 构建常见问题解决方案库
- **分析失败的修改** - 理解为什么某些方法不起作用
- **建立性能基准** - 跟踪优化效果的量化指标
- **定期回顾代码** - 识别可以改进的模式

### 12. 团队协作
- **文档化复杂修改的决策过程**
- **分享调试技巧和发现的最佳实践**
- **建立代码风格一致性** - 便于团队成员理解和维护
- **使用清晰的提交信息** - 描述"什么"和"为什么"

---

**记住：复杂性来自耦合。最好的调试和优化是让代码更简单，而不是更复杂。**

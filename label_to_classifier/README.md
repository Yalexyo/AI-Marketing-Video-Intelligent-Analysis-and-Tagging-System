# 🎯 主标签处理器 + 动态聚类系统

## 🔄 重构后的新架构

### 📁 系统架构
```
label_to_classifier/
├── run.py                          # 🚀 快速运行入口
├── main_tag_processor.py           # 🎯 主标签处理器
├── src/
│   ├── dynamic_clustering_manager.py     # 🎯 动态聚类管理器
│   ├── local_main_tag_classifier.py      # 🤖 本地主标签分类器
│   ├── json_processor.py                 # 📄 JSON文件处理器
│   └── main_tag_prompt_templates.py      # 💭 提示词模板
└── config/
    └── env_config.txt              # ⚙️ 环境配置
```

### 🎯 核心功能

#### 1. **主标签分类**
- **输入**: 🎬Slice目录下的切片JSON文件
- **处理**: 基于切片的视觉标签进行4大模块分类
- **模型**: DeepSeek Chat (主模型) + Claude 4 Sonnet (升级模型)

#### 2. **动态聚类**
- **输入**: 主标签分类结果
- **处理**: 自动生成4大模块文件夹 + 二级聚类
- **输出**: 📁生成结果 目录下的动态文件夹结构

### 🎨 4大主模块 + 二级聚类

#### 🪝 钩子
- **问题描述**: 宝宝哭闹、育儿困扰
- **专家建议**: 权威指导、专业建议  
- **焦虑表达**: 家长困惑、担心表达

#### 🍼 产品介绍 (整合营养科学)
- **产品展示**: 产品包装展示
- **营养科学**: HMO、成分、配方研究
- **专业认证**: 权威背书、认证
- **成分表识别**: 营养成分标签
- **A2标签识别**: A2蛋白相关内容 ⭐

#### 🌟 使用效果
- **宝宝成长**: 健康发育效果
- **使用场景**: 日常使用情况
- **效果对比**: 使用前后对比

#### 🎁 促销机制
- **妈妈场景**: 育儿场景展示
- **情感表达**: 情感连接
- **推荐引导**: 购买引导

### 🚀 使用方法

#### 快速开始
```bash
# 交互模式
cd label_to_classifier
python run.py

# 命令行模式
python run.py overview                    # 查看概览
python run.py all-cluster               # 一键处理（分类+聚类）
python run.py cluster                   # 仅执行聚类
```

#### 完整参数
```bash
# 一键处理（推荐）
python run.py all-cluster [force] [no-backup] [output=路径]

# 分步处理
python run.py all [force] [no-backup]    # 仅分类
python run.py cluster [output=路径]       # 仅聚类

# 单个视频
python run.py video_1 [force] [no-backup]
```

### 📊 输出结果

#### 动态文件夹结构
```
📁生成结果/动态聚类_20250107_123456/
├── 🪝_钩子/
│   ├── 问题描述/
│   ├── 专家建议/
│   └── 焦虑表达/
├── 🍼_产品介绍/
│   ├── 产品展示/
│   ├── 营养科学/
│   ├── 专业认证/
│   ├── 成分表识别/
│   └── A2标签识别/      # ⭐ 新增
├── 🌟_使用效果/
│   ├── 宝宝成长/
│   ├── 使用场景/
│   └── 效果对比/
├── 🎁_促销机制/
│   ├── 妈妈场景/
│   ├── 情感表达/
│   └── 推荐引导/
└── 🎯_动态聚类报告.json
```

#### 聚类文件组织
```
每个子类别文件夹/
├── 视频文件/              # 按置信度排序的视频文件
├── 分析文件/              # 对应的JSON分析文件
└── 📋_概览.json          # 该类别的统计概览
```

### 🔄 重构变化

#### ✅ 新增功能
- **动态聚类**: 基于分析结果自动生成文件夹
- **A2标签识别**: 专门识别A2蛋白相关内容
- **营养科学整合**: 合并到产品介绍模块
- **一键处理**: 分类+聚类一步完成

#### ❌ 删除功能
- **参考脚本逻辑**: 删除基于SRT的参考视频分析
- **硬编码结构**: 改为动态生成文件夹

### ⚙️ 配置说明

#### 环境变量 (config/env_config.txt)
```
DEEPSEEK_API_KEY=your_key_here
OPENROUTER_API_KEY=your_key_here
```

#### 重要参数
- `min_confidence`: 最小置信度阈值 (默认: 0.5)
- `backup_enabled`: 是否备份原文件 (默认: True)
- `force_reprocess`: 是否强制重新处理 (默认: False)

### 🎯 使用建议

1. **首次使用**: `python run.py all-cluster` 一键完成
2. **新增视频**: `python run.py video_X` 处理单个
3. **重新聚类**: `python run.py cluster` 基于已有分类
4. **查看状态**: `python run.py overview` 了解处理进度

### 🔧 故障排除

#### 常见问题
- **API配置**: 检查 config/env_config.txt 中的API密钥
- **权限问题**: 确保有 🎬Slice 目录的读写权限
- **聚类失败**: 确保已完成主标签分类

#### 日志位置
- 处理日志: `logs/` 目录
- 错误信息: 控制台输出

---

## 🎉 新架构优势

1. **动态灵活**: 根据分析结果自动调整文件夹结构
2. **模块化**: 主标签分类和聚类分离，便于维护
3. **智能识别**: 专门的A2标签识别，营养科学整合
4. **一键操作**: 简化工作流程，提升效率
5. **可扩展**: 容易添加新的聚类规则和主模块 
# 🚀 一键DD - AI视频智能分类处理程序使用说明

## 🎯 程序概述

一键DD是一个完整的视频分类自动化处理程序，能够从原始视频切片自动生成按品牌分类的最终视频文件。支持智能检测处理起点，实现真正的"一键式"全流程处理。

## 📋 完整分析流程

### 流程图
```
🎬 视频切片 → 🏷️ 阶段0(视频标签分析) → 🎯 阶段1(一级主标签) → 📊 阶段2(二级副标签) → 📁 阶段3(文件生成) → 📂 最终结果
```

### 各阶段详细说明

| 阶段 | 功能 | 输入 | 输出 | 耗时 | 是否必需 |
|------|------|------|------|------|----------|
| **前置检查** | 系统环境验证 | 系统状态、API配置 | 处理概览 | 1分钟 | ✅ 必需 |
| **🏷️ 阶段0** | 视频标签分析 | `*.mp4`视频切片 | `*_analysis.json`标注文件 | 5-30分钟 | ❓ 条件执行 |
| **🎯 阶段1** | 一级主标签分类 | JSON标注文件 | 带`main_tag`字段的JSON | 3-10分钟 | ✅ 必需 |
| **📊 阶段2** | 二级副标签聚类 | 一级分类JSON | 带`secondary_category`字段的JSON | 6-25分钟 | ✅ 必需 |
| **📁 阶段3** | 智能文件生成 | 二级分类JSON | 分类文件夹和CSV报告 | 2-8分钟 | ✅ 必需 |

## 🔧 使用前准备

### 1. 系统要求
- **UV包管理器**: 必须安装 `uv` 命令
- **Python环境**: 各模块需要独立的Python环境
- **磁盘空间**: 确保有足够空间存储结果文件

### 2. 目录结构要求
```
项目根目录/
├── 🎬Slice/                    # 视频切片目录（必需）
│   ├── video_1/slices/        # 视频1的切片
│   │   ├── slice_001.mp4
│   │   ├── slice_002.mp4
│   │   └── slice_001_analysis.json  # 可选，如无则自动生成
│   └── video_2/slices/        # 视频2的切片
├── label_to_classifier/       # 分类模块（必需）
├── 视频标签.sh               # 标签分析脚本（必需）
├── 视频分类_一级主标签.sh    # 一级分类脚本（必需）
├── 视频分类_二级副标签.sh    # 二级分类脚本（必需）
├── 视频分类_文件生成.sh      # 文件生成脚本（必需）
├── .env                       # API配置文件（必需）
└── 一键DD.sh                 # 主程序（必需）
```

### 3. API配置要求
在项目根目录创建`.env`文件：

```env
# 分类处理API（必需）
DEEPSEEK_API_KEY=your_deepseek_api_key     # 主分析模型，必需
OPENROUTER_API_KEY=your_openrouter_api_key # Claude升级模型，可选

# 视频标签分析API（阶段0需要）
DASHSCOPE_API_KEY=your_dashscope_api_key   # Qwen视觉模型，主要
GOOGLE_AI_API_KEY=your_google_ai_api_key   # Gemini视觉模型，备用
```

## 🚀 使用方法

### 基本用法
```bash
# 在项目根目录执行
./一键DD.sh
```

### 自动化特性
- ✅ **智能起点检测**: 自动判断是否需要从阶段0开始
- ✅ **断点续传**: 支持从任意失败阶段重新开始
- ✅ **无需交互**: 全程自动化处理（除初始确认）
- ✅ **错误恢复**: 智能重试机制和错误处理

## 📊 各阶段详细分析

### 🏷️ 阶段0: 视频标签分析（条件执行）
**执行条件**: 🎬Slice目录下缺少`*_analysis.json`文件时自动执行

**输入数据**:
```
🎬Slice/video_1/slices/
├── slice_001.mp4
├── slice_002.mp4
└── slice_003.mp4
```

**处理内容**:
- 🎯 **视觉AI识别**: 物体、人物、场景检测
- 🎭 **情绪分析**: 开心、温馨、专业等情绪识别
- 🏷️ **品牌元素**: 包装、logo、标识检测
- 🌐 **自动翻译**: 统一转换为中文描述

**输出数据**:
```json
{
  "file_path": "slice_001.mp4",
  "objects": ["奶粉罐", "婴儿", "母亲"],
  "emotions": ["温馨", "开心"],
  "brand_elements": ["蕴淳", "A2"],
  "description": "母亲给宝宝冲奶粉的温馨场景"
}
```

**耗时**: 5-30分钟（取决于视频数量）

### 🎯 阶段1: 一级主标签分类
**输入数据**: 阶段0生成的JSON标注文件

**处理内容**:
- 🤖 **AI模型**: DeepSeek主模型 + Claude升级模型
- 🏷️ **品牌感知**: 自动识别蕴淳、水奶、蓝钻品牌
- 🎯 **主标签分类**: 6大核心分类

**分类体系**:
```
🍼 产品介绍_蕴淳  → HMO功效、A2标签识别、营养科学
🍼 产品介绍_水奶  → 便携特性、即饮演示、新鲜品质
🍼 产品介绍_蓝钻  → 高端配方、升级特性、营养科学
🌟 使用效果      → 营养健康、智能发育、安全保护
🎁 促销机制      → 价格优势、限时活动、赠品套装
🪝 钩子         → 问题场景、需求痛点、紧迫时机
```

**输出数据**:
```json
{
  "file_path": "slice_001.mp4",
  "main_tag": "产品介绍_蕴淳",
  "confidence": 0.95,
  "reasoning": "视频展示了蕴淳奶粉的HMO功效特点"
}
```

**耗时**: 3-10分钟

### 📊 阶段2: 二级副标签聚类
**输入数据**: 带有`main_tag`字段的JSON文件

**处理内容**:
- 🎯 **聚类分析**: 基于主标签进行4-7个子分类
- 🏷️ **语义分析**: 深度理解视频内容主题
- 📊 **智能聚类**: 自动发现内容相似性

**二级分类示例**:
```
产品介绍_蕴淳:
  ├── HMO功效 (母乳低聚糖相关)
  ├── A2标签识别 (A2蛋白优势)
  ├── 营养科学 (科学配方)
  ├── 专业认证 (权威认证)
  └── 使用演示 (冲调演示)
```

**输出数据**:
```json
{
  "file_path": "slice_001.mp4",
  "main_tag": "产品介绍_蕴淳",
  "secondary_category": "HMO功效",
  "theme_description": "母乳低聚糖介绍",
  "confidence": 0.92
}
```

**耗时**: 6-25分钟

### 📁 阶段3: 智能文件生成
**输入数据**: 带有`secondary_category`字段的JSON文件

**处理内容**:
- 📁 **文件夹创建**: 按主标签创建分类文件夹
- 📝 **语义化命名**: `{二级标签}_{主题描述}.mp4`
- 📊 **报告生成**: 详细的CSV分类报告
- 🔗 **文件复制**: 将原始文件复制到分类文件夹

**输出结构**:
```
📁生成结果/视频分类文件生成_20240101_120000/
├── 🍼 产品介绍_蕴淳/
│   ├── HMO功效_母乳低聚糖介绍.mp4
│   ├── A2标签识别_A2蛋白优势.mp4
│   └── 营养科学_科学配方解析.mp4
├── 🍼 产品介绍_水奶/
│   ├── 便携特性_随身携带演示.mp4
│   └── 即饮演示_开盖即饮.mp4
├── 🌟 使用效果/
│   ├── 营养健康_宝宝活力表现.mp4
│   └── 智能发育_认知能力提升.mp4
└── 📊 视频分类文件生成报告.csv
```

**CSV报告格式**:
```csv
原文件名,主标签,二级标签,主题描述,新文件名,文件路径
slice_001.mp4,产品介绍_蕴淳,HMO功效,母乳低聚糖介绍,HMO功效_母乳低聚糖介绍.mp4,产品介绍_蕴淳/HMO功效_母乳低聚糖介绍.mp4
```

**耗时**: 2-8分钟

## ⏱️ 性能指标

### 完整流程耗时（含阶段0）
| 文件规模 | 阶段0 | 阶段1 | 阶段2 | 阶段3 | 总耗时 |
|----------|-------|-------|-------|-------|--------|
| <20个文件 | 8-12分钟 | 3-5分钟 | 6-8分钟 | 2-3分钟 | 20-25分钟 |
| 20-50个文件 | 12-18分钟 | 4-6分钟 | 8-12分钟 | 3-5分钟 | 25-35分钟 |
| >50个文件 | 18-30分钟 | 6-10分钟 | 10-15分钟 | 3-8分钟 | 35-50分钟 |

### 部分流程耗时（跳过阶段0）
| 文件规模 | 阶段1 | 阶段2 | 阶段3 | 总耗时 |
|----------|-------|-------|-------|--------|
| <50个文件 | 3-5分钟 | 6-8分钟 | 2-3分钟 | 10-15分钟 |
| 50-200个文件 | 4-8分钟 | 8-15分钟 | 3-5分钟 | 15-25分钟 |
| >200个文件 | 8-15分钟 | 15-25分钟 | 5-10分钟 | 25-40分钟 |

## 💰 成本估算

### API调用费用预估
| 规模 | 完整流程（含阶段0） | 部分流程（跳过阶段0） |
|------|-------------------|---------------------|
| 小规模（<20个文件） | $3-8 | $2-5 |
| 中等规模（20-50个文件） | $8-15 | $5-10 |
| 大规模（>50个文件） | $15-25 | $10-20 |

### 成本优化建议
- ✅ **配置OpenRouter**: 启用智能升级机制，提高准确率
- ✅ **批量处理**: 一次处理多个项目以平摊成本
- ✅ **增量处理**: 支持断点续传，避免重复计费

## 🎯 特色功能

### 🤖 智能AI架构
- **主模型**: DeepSeek Chat（快速高效，成本低）
- **升级模型**: Claude 4 Sonnet（高精度验证）
- **智能切换**: 错误率>15%时自动升级到高精度模型
- **置信度过滤**: 仅保留高置信度结果

### 🏷️ 品牌感知能力
- **自动识别**: 蕴淳、水奶、蓝钻三个品牌
- **专属分类**: 每个品牌有独特的二级分类体系
- **关键词识别**: 品牌特定的关键词和特征

### 📁 语义化命名
- **格式**: `{二级标签}_{视频主题描述}.mp4`
- **示例**: `HMO功效_母乳低聚糖介绍.mp4`
- **优势**: 直观易懂，便于快速定位和使用

## 🔧 故障排除

### 常见问题及解决方案

| 问题 | 可能原因 | 解决方案 |
|------|----------|----------|
| 🎬Slice目录不存在 | 未运行视频切片程序 | 先运行视频切片和标签程序 |
| ❌ API密钥未配置 | .env文件缺失或配置错误 | 检查.env文件中的API密钥配置 |
| ⏱️ 处理超时 | 网络问题或文件过多 | 检查网络连接，考虑分批处理 |
| 💾 磁盘空间不足 | 输出文件占用空间过大 | 清理临时文件，确保足够空间 |
| 🔄 阶段失败 | API调用失败或数据格式错误 | 检查API余额，验证输入数据格式 |

### 恢复处理
```bash
# 单独运行失败的阶段
./视频分类_一级主标签.sh      # 重新运行阶段1
./视频分类_二级副标签.sh      # 重新运行阶段2
./视频分类_文件生成.sh        # 重新运行阶段3
```

## 📞 技术支持

### 检查清单
- [ ] UV包管理器已安装
- [ ] 🎬Slice目录存在且包含视频文件
- [ ] .env文件正确配置API密钥
- [ ] 网络连接正常
- [ ] 磁盘空间充足
- [ ] API账户余额充足

### 日志调试
程序运行时会显示详细的进度信息，包括：
- 📊 文件统计信息
- 🔄 各阶段处理状态
- ⚠️ 错误信息和建议
- ✅ 成功完成的确认

## 🎉 使用总结

一键DD脚本提供了完整的视频分类自动化解决方案，特别适合需要品牌感知分类的场景。通过智能检测处理起点、双AI架构和语义化命名，实现了从原始视频切片到最终分类文件的全自动化处理，大大提升了视频内容管理的效率和准确性。

**核心优势**:
- 🚀 **真正一键**: 智能检测，自动执行所需阶段
- 🎯 **品牌感知**: 支持蕴淳、水奶、蓝钻品牌自动识别
- 🤖 **双AI架构**: 成本与精度的完美平衡
- 📁 **语义命名**: 直观易懂的文件组织方式
- 🔄 **容错恢复**: 支持断点续传和错误恢复 